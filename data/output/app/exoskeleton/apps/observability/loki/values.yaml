# Loki Helm Values
# Rendered by Bootstrappo Composer

image:
  repository: grafana/loki
  tag: latest

env:
  - name: AWS_ACCESS_KEY_ID
    valueFrom:
      secretKeyRef:
        name: minio-creds
        key: AWS_ACCESS_KEY_ID
  - name: AWS_SECRET_ACCESS_KEY
    valueFrom:
      secretKeyRef:
        name: minio-creds
        key: AWS_SECRET_ACCESS_KEY

service:
  type: ClusterIP
  port: 3100

persistence:
  data:
    enabled: true
    size: 50Gi
    storageClassName: local-path

# Loki Config with S3 (MinIO)
config: |
  auth_enabled: false
  server:
    http_listen_port: 3100
    grpc_listen_port: 9096
  common:
    path_prefix: /loki
    storage:
      s3:
        endpoint: http://minio.minio.svc.cluster.local:9000
        bucketnames: loki-data
        insecure: true
        s3forcepathstyle: true
        # Credentials from env vars
      instance_addr: 127.0.0.1
    ring:
      kvstore:
        store: inmemory
  schema_config:
    configs:
      - from: 2020-10-24
        store: boltdb-shipper
        object_store: s3
        schema: v11
        index:
          prefix: index_
          period: 24h
  storage_config:
    boltdb_shipper:
      active_index_directory: /loki/boltdb-shipper-active
      cache_location: /loki/boltdb-shipper-cache
      cache_ttl: 24h
      shared_store: s3
    filesystem:
      directory: /loki/chunks
  compactor:
    working_directory: /loki/boltdb-shipper-compactor
    shared_store: s3
  limits_config:
    reject_old_samples: true
    reject_old_samples_max_age: 168h
  chunk_store_config:
    max_look_back_period: 0s
  table_manager:
    retention_deletes_enabled: true
    retention_period: 336h # 14 days
