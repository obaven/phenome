# Vector Helm Values
# Rendered by Bootstrappo Composer

image:
  repository: timberio/vector
  tag: nightly-alpine

env:
  - name: VECTOR_LOG
    value: "info"
  - name: VECTOR_SELF_NODE_NAME
    valueFrom:
      fieldRef:
        fieldPath: spec.nodeName
  - name: VECTOR_SELF_POD_NAME
    valueFrom:
      fieldRef:
        fieldPath: metadata.name
  - name: VECTOR_SELF_POD_NAMESPACE
    valueFrom:
      fieldRef:
        fieldPath: metadata.namespace

service:
  type: ClusterIP
  port: 9000

customConfig: |
  [api]
  enabled = true
  address = "0.0.0.0:8686"

  [sources.kubernetes_logs]
  type = "kubernetes_logs"

  # Sink to Loki
  [sinks.loki]
  type = "loki"
  inputs = ["kubernetes_logs"]
  endpoint = "http://loki.observability.svc.cluster.local:3100"
  encoding.codec = "json"
  
  # Sink to Prometheus (Expose metrics)
  [sources.internal_metrics]
  type = "internal_metrics"

  [sinks.prometheus]
  type = "prometheus_exporter"
  inputs = ["internal_metrics"]
  address = "0.0.0.0:9090"
